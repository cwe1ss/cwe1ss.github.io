<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Testable and reusable cookie access with ASP.Net MVC RC - Christian Weiss</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/">
<meta property="og:site_name" content="Christian Weiss"><meta property="og:title" content="Testable and reusable cookie access with ASP.Net MVC RC"><meta property="og:description" content="All good things come in threes, so I’m writing another post about how to access cookie or sessions. I got inspired by a comment from Chris Marisic, who suggested to use a more testable way for this stuff!
Previous posts about this topic:
Don’t use Response.Cookies[string] to check if a cookie exists! Use wrappers to access your cookies, sessions, … Intro Using static wrapper properties is a quick and easy way, but you can’t unit test them because they access HttpContext.Current directly. This time I will show you, how you can build a fully unit testable and strongly typed way to access your cookies. As there has been Christmas time 2 days ago (ASP.Net MVC RC1 was released *g*) I’m using the latest MVC bits for my example!
A Reusable Cookie Container The cookie container is responsible for getting values out of and into the cookie collections. It does not know which concrete values I’m using in my application! This is implemented in a different level, so you can use this class for all of your applications!
In my implementation it’s possible to store “objects” in cookies. I’ve implemented it this way because I don’t want to convert all my DateTime, int, … cookies every time! But I also don’t want someone to save Lists or any other complex types, so my SetValue() method validates the type of the value and throws an exception, if it’s not a value type or nullable value type. That’s a little type checking, but I think it is worth it because cookies are set quite rarely!"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-01-28T18:35:00+01:00"><meta property="article:modified_time" content="2009-01-28T18:35:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Testable and reusable cookie access with ASP.Net MVC RC"><meta name=twitter:description content="All good things come in threes, so I’m writing another post about how to access cookie or sessions. I got inspired by a comment from Chris Marisic, who suggested to use a more testable way for this stuff!
Previous posts about this topic:
Don’t use Response.Cookies[string] to check if a cookie exists! Use wrappers to access your cookies, sessions, … Intro Using static wrapper properties is a quick and easy way, but you can’t unit test them because they access HttpContext.Current directly. This time I will show you, how you can build a fully unit testable and strongly typed way to access your cookies. As there has been Christmas time 2 days ago (ASP.Net MVC RC1 was released *g*) I’m using the latest MVC bits for my example!
A Reusable Cookie Container The cookie container is responsible for getting values out of and into the cookie collections. It does not know which concrete values I’m using in my application! This is implemented in a different level, so you can use this class for all of your applications!
In my implementation it’s possible to store “objects” in cookies. I’ve implemented it this way because I don’t want to convert all my DateTime, int, … cookies every time! But I also don’t want someone to save Lists or any other complex types, so my SetValue() method validates the type of the value and throws an exception, if it’s not a value type or nullable value type. That’s a little type checking, but I think it is worth it because cookies are set quite rarely!"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/><link rel=prev href=https://www.chwe.at/2009/01/use-wrappers-to-access-your-cookies-sessions/><link rel=next href=https://www.chwe.at/2009/02/meet-me-at-basta-spring-2009/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/css/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Testable and reusable cookie access with ASP.Net MVC RC","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.chwe.at\/2009\/01\/testable-and-reusable-cookie-access-with-asp.net-mvc-rc\/"},"genre":"posts","wordcount":863,"url":"https:\/\/www.chwe.at\/2009\/01\/testable-and-reusable-cookie-access-with-asp.net-mvc-rc\/","datePublished":"2009-01-28T18:35:00+01:00","dateModified":"2009-01-28T18:35:00+01:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xxxx"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>const query=window.matchMedia("(prefers-color-scheme: dark)");function applyTheme(){let e=window.localStorage?.getItem("theme")||"auto",t=e==="dark"||e==="auto"&&query.matches;document.body.setAttribute("theme",t?"dark":"light"),document.body.setAttribute("cfg-theme",e)}applyTheme(),query.addEventListener("change",applyTheme)</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Christian Weiss">My cool site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Christian Weiss">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Testable and reusable cookie access with ASP.Net MVC RC</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>xxxx</a></span>&nbsp;<span class=post-category>included in <a href=/categories/.net/><i class="far fa-folder fa-fw" aria-hidden=true></i>.NET</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2009-01-28>2009-01-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;863 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#intro>Intro</a></li><li><a href=#a-reusable-cookie-container>A Reusable Cookie Container</a></li><li><a href=#how-to-use-it-in-your-application>How to use it in your application</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>All good things come in threes, so I&rsquo;m writing another post about how to access cookie or sessions. I got inspired by a comment from <a href=http://www.marisic.net/ target=_blank rel="noopener noreffer">Chris Marisic</a>, who suggested to use a more testable way for this stuff!</p><p>Previous posts about this topic:</p><ul><li><a href=https://www.chwe.at/2009/01/don-t-use-response.cookies-string--to-check-if-a-cookie-exists/ rel>Don&rsquo;t use Response.Cookies[string] to check if a cookie exists!</a></li><li><a href=https://www.chwe.at/2009/01/use-wrappers-to-access-your-cookies-sessions/ rel>Use wrappers to access your cookies, sessions, &mldr;</a></li></ul><h3 id=intro>Intro</h3><p>Using static wrapper properties is a quick and easy way, but you can&rsquo;t unit test them because they access HttpContext.Current directly. This time I will show you, how you can build a fully unit testable and strongly typed way to access your cookies. As there has been Christmas time 2 days ago (<a href=http://weblogs.asp.net/scottgu/archive/2009/01/27/asp-net-mvc-1-0-release-candidate-now-available.aspx target=_blank rel="noopener noreffer">ASP.Net MVC RC1 was released</a> *g*) I’m using the latest MVC bits for my example!</p><h3 id=a-reusable-cookie-container>A Reusable Cookie Container</h3><p>The cookie container is responsible for getting values out of and into the cookie collections. It does not know which concrete values I&rsquo;m using in my application! This is implemented in a different level, so you can use this class for all of your applications!</p><p>In my implementation it&rsquo;s possible to store &ldquo;objects&rdquo; in cookies. I&rsquo;ve implemented it this way because I don&rsquo;t want to convert all my DateTime, int, &mldr; cookies every time! But I also don&rsquo;t want someone to save Lists or any other complex types, so my SetValue() method validates the type of the value and throws an exception, if it&rsquo;s not a value type or nullable value type. That&rsquo;s a little type checking, but I think it is worth it because cookies are set quite rarely!</p><p>Here’s the interface:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c#"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>ICookieContainer</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>Exists</span><span class=p>(</span><span class=kt>string</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>GetValue</span><span class=p>(</span><span class=kt>string</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>GetValue</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span><span class=kt>string</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>SetValue</span><span class=p>(</span><span class=kt>string</span> <span class=n>key</span><span class=p>,</span> <span class=kt>object</span> <span class=k>value</span><span class=p>,</span> <span class=n>DateTime</span> <span class=n>expires</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>I will just show the fundamental code here. If you want to see the whole implementation, please take a look at the code sample. (see bottom)</p><p>As you can see below, I&rsquo;ve used the abstracted versions of HttpRequest and HttpResponse, which you get, if you use ASP.Net MVC. That&rsquo;s just one of thousand things I love about ASP.Net MVC. These classes can be used easily in unit tests. Notice that everything can be injected here. There’s no direct access to HttpContext.Current!</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c#"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>CookieContainer</span> <span class=p>:</span> <span class=n>ICookieContainer</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>HttpRequestBase</span> <span class=n>_request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>HttpResponseBase</span> <span class=n>_response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CookieContainer</span><span class=p>(</span><span class=n>HttpRequestBase</span> <span class=n>request</span><span class=p>,</span> <span class=n>HttpResponseBase</span> <span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// &#34;Check&#34; is a helper class, I&#39;ve got from the &#34;Kigg&#34; project</span>
</span></span><span class=line><span class=cl>        <span class=n>Check</span><span class=p>.</span><span class=n>IsNotNull</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s>&#34;request&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Check</span><span class=p>.</span><span class=n>IsNotNull</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=s>&#34;response&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>_request</span> <span class=p>=</span> <span class=n>request</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_response</span> <span class=p>=</span> <span class=n>response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>GetValue</span><span class=p>(</span><span class=kt>string</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Check</span><span class=p>.</span><span class=n>IsNotEmpty</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=s>&#34;key&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>HttpCookie</span> <span class=n>cookie</span> <span class=p>=</span> <span class=n>_request</span><span class=p>.</span><span class=n>Cookies</span><span class=p>[</span><span class=n>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cookie</span> <span class=p>!=</span> <span class=kc>null</span> <span class=p>?</span> <span class=n>cookie</span><span class=p>.</span><span class=n>Value</span> <span class=p>:</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>void</span> <span class=n>SetValue</span><span class=p>(</span><span class=kt>string</span> <span class=n>key</span><span class=p>,</span> <span class=kt>object</span> <span class=k>value</span><span class=p>,</span> <span class=n>DateTime</span> <span class=n>expires</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Check</span><span class=p>.</span><span class=n>IsNotEmpty</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=s>&#34;key&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>strValue</span> <span class=p>=</span> <span class=n>CheckAndConvertValue</span><span class=p>(</span><span class=k>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>HttpCookie</span> <span class=n>cookie</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HttpCookie</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>strValue</span><span class=p>)</span> <span class=p>{</span><span class=n>Expires</span> <span class=p>=</span> <span class=n>expires</span><span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>_response</span><span class=p>.</span><span class=n>Cookies</span><span class=p>.</span><span class=n>Set</span><span class=p>(</span><span class=n>cookie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// ... see code sample for full implementation</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>Here’s a sample unit tests that proves the testability of this code. I use <a href=http://code.google.com/p/moq/ target=_blank rel="noopener noreffer">Moq</a> as my mocking framework.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c#"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=k>class</span> <span class=nc>Mocks</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Mock</span><span class=p>&amp;</span><span class=n>lt</span><span class=p>;</span><span class=n>HttpRequestBase</span><span class=p>&amp;</span><span class=n>gt</span><span class=p>;</span> <span class=n>HttpRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>httpRequest</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Mock</span><span class=p>&amp;</span><span class=n>lt</span><span class=p>;</span><span class=n>HttpRequestBase</span><span class=p>&amp;</span><span class=n>gt</span><span class=p>;();</span>
</span></span><span class=line><span class=cl>        <span class=n>httpRequest</span><span class=p>.</span><span class=n>Setup</span><span class=p>(</span><span class=n>x</span> <span class=p>=&amp;</span><span class=n>gt</span><span class=p>;</span> <span class=n>x</span><span class=p>.</span><span class=n>Cookies</span><span class=p>).</span><span class=n>Returns</span><span class=p>(</span><span class=k>new</span> <span class=n>HttpCookieCollection</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>httpRequest</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Mock</span><span class=p>&amp;</span><span class=n>lt</span><span class=p>;</span><span class=n>HttpResponseBase</span><span class=p>&amp;</span><span class=n>gt</span><span class=p>;</span> <span class=n>HttpResponse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>httpResponse</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Mock</span><span class=p>&amp;</span><span class=n>lt</span><span class=p>;</span><span class=n>HttpResponseBase</span><span class=p>&amp;</span><span class=n>gt</span><span class=p>;();</span>
</span></span><span class=line><span class=cl>        <span class=n>httpResponse</span><span class=p>.</span><span class=n>Setup</span><span class=p>(</span><span class=n>x</span> <span class=p>=&amp;</span><span class=n>gt</span><span class=p>;</span> <span class=n>x</span><span class=p>.</span><span class=n>Cookies</span><span class=p>).</span><span class=n>Returns</span><span class=p>(</span><span class=k>new</span> <span class=n>HttpCookieCollection</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>httpResponse</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// This method is from my CookieContainerTests class</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>[TestMethod]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>void</span> <span class=n>SetValue_UpdatesExistingCookie</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Arrange</span>
</span></span><span class=line><span class=cl>    <span class=kd>const</span> <span class=kt>string</span> <span class=n>cookieName</span> <span class=p>=</span> <span class=s>&#34;myCookie&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>const</span> <span class=kt>string</span> <span class=n>cookieValue</span> <span class=p>=</span> <span class=s>&#34;myValue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span> <span class=n>cookieExpires</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DateTime</span><span class=p>(</span><span class=m>2009</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>httpRequest</span> <span class=p>=</span> <span class=n>Mocks</span><span class=p>.</span><span class=n>HttpRequest</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>httpResponse</span> <span class=p>=</span> <span class=n>Mocks</span><span class=p>.</span><span class=n>HttpResponse</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>cookieContainer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>CookieContainer</span><span class=p>(</span><span class=n>httpRequest</span><span class=p>.</span><span class=n>Object</span><span class=p>,</span> <span class=n>httpResponse</span><span class=p>.</span><span class=n>Object</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>httpResponse</span><span class=p>.</span><span class=n>Object</span><span class=p>.</span><span class=n>Cookies</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=k>new</span> <span class=n>HttpCookie</span><span class=p>(</span><span class=n>cookieName</span><span class=p>,</span> <span class=s>&#34;oldValue&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Act</span>
</span></span><span class=line><span class=cl>    <span class=n>_cookieContainer</span><span class=p>.</span><span class=n>SetValue</span><span class=p>(</span><span class=n>cookieName</span><span class=p>,</span> <span class=n>cookieValue</span><span class=p>,</span> <span class=n>cookieExpires</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Assert</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpCookie</span> <span class=n>cookie</span> <span class=p>=</span> <span class=n>httpResponse</span><span class=p>.</span><span class=n>Object</span><span class=p>.</span><span class=n>Cookies</span><span class=p>[</span><span class=s>&#34;myCookie&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>Assert</span><span class=p>.</span><span class=n>IsNotNull</span><span class=p>(</span><span class=n>cookie</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Assert</span><span class=p>.</span><span class=n>AreEqual</span><span class=p>(</span><span class=n>cookie</span><span class=p>.</span><span class=n>Name</span><span class=p>,</span> <span class=n>cookieName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Assert</span><span class=p>.</span><span class=n>AreEqual</span><span class=p>(</span><span class=n>cookie</span><span class=p>.</span><span class=n>Value</span><span class=p>,</span> <span class=n>cookieValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Assert</span><span class=p>.</span><span class=n>AreEqual</span><span class=p>(</span><span class=n>cookie</span><span class=p>.</span><span class=n>Expires</span><span class=p>,</span> <span class=n>cookieExpires</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>That’s it! Now you have a testable and reusable cookie container!</p><h3 id=how-to-use-it-in-your-application>How to use it in your application</h3><p>It&rsquo;s really easy to integrate this into your app! Just create an interface that defines all your application-specific properties you want to save in cookies and a concrete implementation of this interface that interacts with the cookie container.</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c#"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kd>public</span> <span class=k>interface</span> <span class=nc>IAppCookies</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>UserEmail</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>DateTime</span><span class=p>?</span> <span class=n>LastVisit</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>AppCookies</span> <span class=p>:</span> <span class=n>IAppCookies</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ICookieContainer</span> <span class=n>_cookieContainer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>AppCookies</span><span class=p>(</span><span class=n>ICookieContainer</span> <span class=n>cookieContainer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_cookieContainer</span> <span class=p>=</span> <span class=n>cookieContainer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>UserEmail</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>_cookieContainer</span><span class=p>.</span><span class=n>GetValue</span><span class=p>(</span><span class=s>&#34;UserEmail&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>set</span> <span class=p>{</span> <span class=n>_cookieContainer</span><span class=p>.</span><span class=n>SetValue</span><span class=p>(</span><span class=s>&#34;UserEmail&#34;</span><span class=p>,</span> <span class=k>value</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>AddDays</span><span class=p>(</span><span class=m>10</span><span class=p>));</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>DateTime</span><span class=p>?</span> <span class=n>LastVisit</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span> <span class=p>{</span> <span class=k>return</span> <span class=n>_cookieContainer</span><span class=p>.</span><span class=n>GetValue</span><span class=p>&amp;</span><span class=n>lt</span><span class=p>;</span><span class=n>DateTime</span><span class=p>?&amp;</span><span class=n>gt</span><span class=p>;(</span><span class=s>&#34;LastVisit&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>set</span> <span class=p>{</span> <span class=n>_cookieContainer</span><span class=p>.</span><span class=n>SetValue</span><span class=p>(</span><span class=s>&#34;LastVisit&#34;</span><span class=p>,</span> <span class=k>value</span><span class=p>,</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>AddDays</span><span class=p>(</span><span class=m>10</span><span class=p>));</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>You can now inject this IAppCookies interface to your MVC Controller:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c#"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HomeController</span> <span class=p>:</span> <span class=n>Controller</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>IAppCookies</span> <span class=n>_cookies</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HomeController</span><span class=p>(</span><span class=n>IAppCookies</span> <span class=n>cookies</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_cookies</span> <span class=p>=</span> <span class=n>cookies</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ActionResult</span> <span class=n>Index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DateTime</span> <span class=n>currentTime</span> <span class=p>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>IndexViewModel</span> <span class=n>viewModel</span> <span class=p>=</span> <span class=k>new</span> <span class=n>IndexViewModel</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CurrentTime</span> <span class=p>=</span> <span class=n>currentTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>LastVisit</span> <span class=p>=</span> <span class=p>(</span><span class=n>_cookies</span><span class=p>.</span><span class=n>LastVisit</span> <span class=p>??</span> <span class=n>currentTime</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>UserEmail</span> <span class=p>=</span> <span class=n>_cookies</span><span class=p>.</span><span class=n>UserEmail</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>_cookies</span><span class=p>.</span><span class=n>LastVisit</span> <span class=p>=</span> <span class=n>currentTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>View</span><span class=p>(</span><span class=n>viewModel</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=k>class</span> <span class=nc>IndexViewModel</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>string</span> <span class=n>UserEmail</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>LastVisit</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>DateTime</span> <span class=n>CurrentTime</span> <span class=p>{</span> <span class=k>get</span><span class=p>;</span> <span class=k>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>Wow, you’re still reading :-)</p><p>That’s all I want to show here! If you want to see more about how the IOC is set up (I’m using <a href=http://structuremap.sourceforge.net/Default.htm target=_blank rel="noopener noreffer">StructureMap</a>) or anything else, take a look at the full code:</p><ul><li><a href=http://cid-16ce9c120fa181c9.skydrive.live.com/self.aspx/chwe.at%20blog/090129%7C_CookieContainerApp.zip target=_blank rel="noopener noreffer">Download full code sample</a></li></ul><p>I look forward to hearing your feedback on this!</p><p>Thanks for reading,<br>Christian Weiss</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2009-01-28</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i data-svg-src=/lib/simple-icons/icons/line.min.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Evernote" data-sharer=evernote data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC"><i class="fab fa-evernote fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=https://www.chwe.at/2009/01/testable-and-reusable-cookie-access-with-asp.net-mvc-rc/ data-title="Testable and reusable cookie access with ASP.Net MVC RC" data-description><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fwww.chwe.at%2f2009%2f01%2ftestable-and-reusable-cookie-access-with-asp.net-mvc-rc%2f&amp;text=Testable%20and%20reusable%20cookie%20access%20with%20ASP.Net%20MVC%20RC" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2009/01/use-wrappers-to-access-your-cookies-sessions/ class=prev rel=prev title="Use wrappers to access your cookies, sessions, ..."><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Use wrappers to access your cookies, sessions, ...</a>
<a href=/2009/02/meet-me-at-basta-spring-2009/ class=next rel=next title="Meet me @ BASTA! Spring 2009">Meet me @ BASTA! Spring 2009<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>xxxx</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><script src=/lib/lazysizes/lazysizes.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script src=/lib/sharer/sharer.min.js></script><script src=/lib/katex/katex.min.js></script><script src=/lib/katex/contrib/auto-render.min.js></script><script src=/lib/katex/contrib/copy-tex.min.js></script><script src=/lib/katex/contrib/mhchem.min.js></script><script>window.config={comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script src=/js/theme.min.js></script></body></html>